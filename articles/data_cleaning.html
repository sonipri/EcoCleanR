<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>EcoCleanR: Overview on Steps for Data cleaning and defining Biogeographic ranges • EcoCleanR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EcoCleanR: Overview on Steps for Data cleaning and defining Biogeographic ranges">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EcoCleanR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cite_data.html">cite_data</a></li>
    <li><a class="dropdown-item" href="../articles/data_cleaning.html">EcoCleanR: Overview on Steps for Data cleaning and defining Biogeographic ranges</a></li>
    <li><a class="dropdown-item" href="../articles/data_merging.html">EcoCleanR: Overview on Steps for Data merging from online bioiversity resources</a></li>
    <li><a class="dropdown-item" href="../articles/stepbystep.html">stepbystep</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>EcoCleanR: Overview on Steps for Data cleaning and defining Biogeographic ranges</h1>
            
      

      <div class="d-none name"><code>data_cleaning.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction:<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this tutorial, we will demonstrate the step-by-step process of
cleaning occurrences and extracting environmental data for the coastal
species Mexacanthina lugubris.</p>
<p>This workflow covers data Cleaning: <br> 1. Remove duplicates<br> 2.
Check bad taxon using WoRMs<br> 3. Improve the coordinate information
utilizing external georeference tools<br> 4. check the coordinate
precision and rounding<br> 5. Flag the records associated with the wrong
ocean/sea and inland<br> 6. Extract the environmental variables<br> 7.
Impute the environmental variables if no assignment from online
resources<br> 8. Identifying outliers<br> 9. Data visualization: <br>
Below is the demonstration of each steps:</p>
<p><strong>Note:</strong> For details on data integration, see the
[<code>data_merging</code>]</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># package loading</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sonipri.github.io/EcoCleanR/">EcoCleanR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># provide example species name</span></span>
<span><span class="va">species_name</span> <span class="op">&lt;-</span> <span class="st">"Mexacanthina lugubris"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step1-remove-duplicates">Step1: Remove duplicates<a class="anchor" aria-label="anchor" href="#step1-remove-duplicates"></a>
</h2>
<p>Remove duplicates from the merged dataset which is a product after
merging data from various sources</p>
<p><code>ec_rm_duplicate</code> will return an occurrence table
“ecodata” after removing duplicates based on unique catalog numbers,
while retaining abundance counts wherever available.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecodata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_rm_duplicate.html">ec_rm_duplicate</a></span><span class="op">(</span><span class="va">Mixdb.occ</span>, catalogNumber <span class="op">=</span> <span class="st">"catalogNumber"</span>, abundance <span class="op">=</span> <span class="st">"abundance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ecodata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Optional to perform: check the institution code</span></span>
<span><span class="co"># inst_counts &lt;- ecodata %&gt;%</span></span>
<span><span class="co"># group_by(institutionCode) %&gt;%</span></span>
<span><span class="co"># summarise(record_count = n(), .groups = "drop")</span></span>
<span></span>
<span><span class="co">### optional to perform..</span></span>
<span><span class="co"># ecodata &lt;- ecodata %&gt;%</span></span>
<span><span class="co"># filter(is.na(institutionCode) | institutionCode != "NRM")</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ec_geographic_map.html">ec_geographic_map</a></span><span class="op">(</span><span class="va">ecodata</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step2-remove-bad-taxa">Step2: Remove bad taxa<a class="anchor" aria-label="anchor" href="#step2-remove-bad-taxa"></a>
</h2>
<p>This step helps to check if any wrong taxonomy has fetched from
online datasources by checking if it is an accepted synonym in the WoRMS
(World Register of Marine Species) taxonomy database</p>
<p><code>ec_worms_synonym</code> returns a table named comparison with
two columns: the first column lists the synonyms accepted in the WoRMS
database, and the second column lists the unique species names from
ecodata with the counts of occurrences</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_worms_synonym.html">ec_worms_synonym</a></span><span class="op">(</span><span class="va">species_name</span>,</span>
<span>  <span class="va">ecodata</span>,</span>
<span>  scientificName <span class="op">=</span> <span class="st">"scientificName"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">)</span></span>
<span><span class="co"># compare the columns to know if any taxa found that is not a synonym in WoRMS data base, filter bad taxa from ecodata using dplyr::filter()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step3-georeferencing-using-external-tool">Step3: Georeferencing using external tool<a class="anchor" aria-label="anchor" href="#step3-georeferencing-using-external-tool"></a>
</h2>
<p>This step generates a table “data_need_correction” that can
potentially assign georeferences based on the locality and verbatim
locality information in the occurrence table by using furntion
<code>ec_flag_with_locality</code>.</p>
<p>This table can be further used as an input file for the GEOLocate
tool to perform georeferencing. Currently, there is no R code available
to automate this process. This process require manual validation on each
records for the assigned coordinates and uncertainty. (see Scenario B in
the manuscript for this example)</p>
<p>Use <code>ec_merge_coorected_Coordinates</code> to assigned corrected
coordinates - latitude, longitude and coordinte uncertainty, back into
main data table. Pre-saved data file ecodata_corrected.rda, an example
to use as template.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecodata</span><span class="op">$</span><span class="va">flag_check_geolocate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_flag_with_locality.html">ec_flag_with_locality</a></span><span class="op">(</span><span class="va">ecodata</span>,</span>
<span>  uncertainty <span class="op">=</span> <span class="st">"coordinateUncertaintyInMeters"</span>,</span>
<span>  locality <span class="op">=</span> <span class="st">"locality"</span>,</span>
<span>  verbatimLocality <span class="op">=</span> <span class="st">"verbatimLocality"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ecodata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">data_need_correction</span> <span class="op">&lt;-</span> <span class="va">ecodata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">flag_check_geolocate</span><span class="op">!=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#save the data as local file to insert in GEOLocate web tool</span></span>
<span><span class="co">#write.csv(data_need_correction, "data_check_geolocate.csv")</span></span>
<span></span>
<span><span class="co">#Load back the corrected coordinate file extracted from GEOLocate </span></span>
<span><span class="co">#ecodata_corrected &lt;- read.csv("M lugubris_corrected_geolocate.csv")</span></span>
<span></span>
<span><span class="co">### Merged records with improved georeference:</span></span>
<span><span class="va">ecodata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_merge_corrected_coordinates.html">ec_merge_corrected_coordinates</a></span><span class="op">(</span></span>
<span>  <span class="va">ecodata_corrected</span>, </span>
<span>  <span class="va">ecodata</span>, </span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>, </span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span>,       </span>
<span>  uncertainty_col <span class="op">=</span> <span class="st">"coordinateUncertaintyInMeters"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ecodata</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">### Plot the map to visualize the datapoints</span></span>
<span><span class="fu"><a href="../reference/ec_geographic_map.html">ec_geographic_map</a></span><span class="op">(</span><span class="va">ecodata</span>, latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>, longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step4-extreme-high-uncertainty">Step4: Extreme high uncertainty<a class="anchor" aria-label="anchor" href="#step4-extreme-high-uncertainty"></a>
</h2>
<p><code>ec_filter_by_uncertainty</code> function can be used in all
scenarios (see manuscript) to help remove extremely high uncertainty
from the remaining data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecodata_cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_filter_by_uncertainty.html">ec_filter_by_uncertainty</a></span><span class="op">(</span><span class="va">ecodata</span>,</span>
<span>  uncertainty_col <span class="op">=</span> <span class="st">"coordinateUncertaintyInMeters"</span>,</span>
<span>  percentile <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  ask <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ecodata_cl</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">### plot the map</span></span>
<span><span class="fu"><a href="../reference/ec_geographic_map.html">ec_geographic_map</a></span><span class="op">(</span><span class="va">ecodata_cl</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step5-coordinate-precision-and-rounding">Step5: Coordinate precision and rounding<a class="anchor" aria-label="anchor" href="#step5-coordinate-precision-and-rounding"></a>
</h2>
<p><code>ec_flag_precision</code> checks the precision of the
coordinates. This function flags the records based on two checkpoints:
1) flag both coordinates independently if they have &lt;2 decimal
points; 2) check if any rounding to the nearest 0.5° in either of those
coordinates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecodata_cl</span><span class="op">$</span><span class="va">flag_precision</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_flag_precision.html">ec_flag_precision</a></span><span class="op">(</span><span class="va">ecodata_cl</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter the flag - flag_cordinate_precision</span></span>
<span><span class="va">ecodata_cl</span> <span class="op">&lt;-</span> <span class="va">ecodata_cl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">flag_precision</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ecodata_cl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step6-records-tagged-to-wrong-oceansea">Step6: Records tagged to wrong ocean/sea<a class="anchor" aria-label="anchor" href="#step6-records-tagged-to-wrong-oceansea"></a>
</h2>
<p><code>ec_flag_non_region</code> function helps identify records that
are incorrectly tagged under the wrong ocean or sea. Expert knowledge is
required to recognize when a species is unlikely to occur in certain
ocean regions. For example, Mexacanthina lugubris is an Eastern Pacific
species; therefore, any occurrences reported from the Atlantic Ocean
would be flagged after running this function. <br> Variables “direction”
accepts input as “east” or “west”, and variable “ocean” accepts input
“atlantic” or “pacific”. <br> If given species lives globally, this
cleaning step would not be needed.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is a heavy processing step, won’t execute during vignette building.</span></span>
<span><span class="va">direction</span> <span class="op">&lt;-</span> <span class="st">"east"</span></span>
<span><span class="va">buffer</span> <span class="op">&lt;-</span> <span class="fl">25000</span></span>
<span><span class="va">ocean</span> <span class="op">&lt;-</span> <span class="st">"pacific"</span></span>
<span><span class="va">ecodata_cl</span><span class="op">$</span><span class="va">flag_non_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_flag_non_region.html">ec_flag_non_region</a></span><span class="op">(</span><span class="va">direction</span>,</span>
<span>  <span class="va">ocean</span>,</span>
<span>  <span class="va">buffer</span>,</span>
<span>  <span class="va">ecodata_cl</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ecodata_cl</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># filter flagged records</span></span>
<span><span class="va">ecodata_cl</span> <span class="op">&lt;-</span> <span class="va">ecodata_cl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">flag_non_region</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">### map view to see accepted records</span></span>
<span><span class="fu"><a href="../reference/ec_geographic_map.html">ec_geographic_map</a></span><span class="op">(</span><span class="va">ecodata_cl</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step7-extract-the-environmental-data">Step7: Extract the environmental data<a class="anchor" aria-label="anchor" href="#step7-extract-the-environmental-data"></a>
</h2>
<p><code>ec_extract_env_layers</code> This function extracts
environmental data for occurrence points using their associated
coordinates. It is designed with the ‘sdmpredictors’ package to extract
layers from sources such as Bio-ORACLE, MARSPEC, and WorldClim.</p>
<p><code>ec_impute_env_values</code> imputes environmental data for
coordinates lacking values in the environmental data sources. This will
provide average value of existing data within input radius.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is a heavy processing step, won’t execute during vignette building.</span></span>
<span><span class="co"># get the unique combination of coordiantes</span></span>
<span><span class="va">ecodata_unique</span> <span class="op">&lt;-</span> <span class="va">ecodata_cl</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitude"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">ecodata_unique</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ecodata_unique</span><span class="op">)</span></span>
<span><span class="co"># It is recommended to check what layers available in sdm_predictors and correct name.</span></span>
<span><span class="co"># available_layers &lt;- list_layers() # returns something like c("BO_sstmean", "BO_sstmax", ...)</span></span>
<span><span class="co"># provide layers as input to env_layers variable</span></span>
<span><span class="va">env_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BO_sstmean"</span>, <span class="st">"BO_sstmin"</span>, <span class="st">"BO_sstmax"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### extraction env layers</span></span>
<span><span class="va">ecodata_unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_extract_env_layers.html">ec_extract_env_layers</a></span><span class="op">(</span><span class="va">ecodata_unique</span>,</span>
<span>  env_layers <span class="op">=</span> <span class="va">env_layers</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># A warning message if layers are in saved in cache.</span></span>
<span></span>
<span><span class="co">### impute env var values those were missing after extraction</span></span>
<span><span class="va">ecodata_unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_impute_env_values.html">ec_impute_env_values</a></span><span class="op">(</span></span>
<span>  <span class="va">ecodata_unique</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  radius_km <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">### omit the coordinate which couldn't get any env values after imputation</span></span>
<span><span class="va">ecodata_unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">ecodata_unique</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step8-identify-outliers">Step8: Identify outliers<a class="anchor" aria-label="anchor" href="#step8-identify-outliers"></a>
</h2>
<p>ec_flag_outlier function helps to identify outliers based on both
spatial (coordinates) and non-spatial (environmental) attributes. (see
manuscript for more detail about this function)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is a heavy processing step, won’t execute during vignette building.</span></span>
<span><span class="co"># Instead of executing it here, we will use a pre-saved cleaned file.</span></span>
<span><span class="va">ecodata_unique</span><span class="op">$</span><span class="va">flag_outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_flag_outlier.html">ec_flag_outlier</a></span><span class="op">(</span><span class="va">ecodata_unique</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  <span class="va">env_layers</span>,</span>
<span>  itr <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  geo_quantile <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  maha_quantile <span class="op">=</span> <span class="fl">0.99</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">outlier</span></span>
<span></span>
<span><span class="co">### these unique combinations of coordiantes, environmental variables and outliers will be mergeed to main ecodata_cl file</span></span>
<span><span class="va">ecodata_cl</span> <span class="op">&lt;-</span> <span class="va">ecodata_cl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ecodata_unique</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitude"</span>, <span class="st">"flag_outliers"</span>, <span class="va">env_layers</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitude"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pre-saved file ecodata_with_outliers instead of using ecodata_cl</span></span>
<span><span class="co">### map view to see records with outlier probability</span></span>
<span><span class="fu"><a href="../reference/ec_geographic_map_w_flag.html">ec_geographic_map_w_flag</a></span><span class="op">(</span><span class="va">ecodata_with_outliers</span>,</span>
<span>  flag_column <span class="op">=</span> <span class="st">"outliers"</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Filter outliers those have higher outlier probability &gt;0.90, 0.95 etc.</span></span>
<span><span class="va">ecodata_cleaned</span> <span class="op">&lt;-</span> <span class="va">ecodata_cl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">flag_outliers</span> <span class="op">&lt;</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### mapview to visualize accepted data</span></span>
<span><span class="fu"><a href="../reference/ec_geographic_map.html">ec_geographic_map</a></span><span class="op">(</span><span class="va">ecodata_cleaned</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step9-display-final-accepted-biogeographic-range">Step9: Display final accepted biogeographic range<a class="anchor" aria-label="anchor" href="#step9-display-final-accepted-biogeographic-range"></a>
</h2>
<p><code>ec_var_summary</code> generates a summary table of accepted
occurrences after data cleaning, showing mean, minimum, and maximum
values for spatial and non-spatial attributes.</p>
<p><code>ec_plot_var_range</code> shows a plot of accepted ranges.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BO_sstmean"</span>, <span class="st">"BO_sstmax"</span>, <span class="st">"BO_sstmin"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ecodata_cleaned"</span><span class="op">)</span></span>
<span><span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ec_var_summary.html">ec_var_summary</a></span><span class="op">(</span><span class="va">ecodata_cleaned</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  <span class="va">env_layers</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_table</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ec_plot_var_range.html">ec_plot_var_range</a></span><span class="op">(</span><span class="va">ecodata_with_outliers</span>,</span>
<span>  summary_df <span class="op">=</span> <span class="va">summary_table</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  env_layers <span class="op">=</span> <span class="va">env_layers</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Further documents:<br></p>
<p>*see data merging vignette: [<code>data_merging</code>]<br></p>
<p>*see citation guidelines for the downloaded files from gbif, obis,
idigbio and InvertEbase vignettes/article/cite_data.rmd</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Priyanka Soni.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
